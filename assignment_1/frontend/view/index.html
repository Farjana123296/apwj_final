<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Shop - Product Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      color: #333;
      padding: 30px;
    }
    h1 {
      color: #2b6777;
    }
    form, .section {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    input, select, button {
      padding: 8px;
      margin: 5px 0;
      width: calc(100% - 20px);
      display: block;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #2b6777;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #24616a;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #e3f2fd;
    }
  </style>
</head>
<body>

<h1>Super Shop Inventory Management</h1>

<div class="section">
  <h2>Add Product</h2>
  <form id="productForm">
    <input type="number" id="id" placeholder="Product ID" required>
    <input type="text" id="name" placeholder="Product Name" required>
    <select id="category">
      <option>BeautyCare</option>
      <option>Vegetables</option>
      <option>Meat</option>
      <option>Groceries</option>
      <option>Others</option>
    </select>
    <input type="number" id="price" placeholder="Price" required>
    <input type="number" id="quantity" placeholder="Quantity" required>
    <input type="date" id="expiryDate">
    <select id="availability">
      <option value="true">Available</option>
      <option value="false">Not Available</option>
    </select>
    <button type="submit">Add Product</button>
  </form>
</div>

<div class="section">
  <h2>Update Product</h2>
  <form id="updateForm">
    <input type="number" id="updateId" placeholder="Product ID" required>
    <input type="text" id="updateName" placeholder="Product Name" required>
    <select id="updateCategory">
      <option>BeautyCare</option>
      <option>Vegetables</option>
      <option>Meat</option>
      <option>Groceries</option>
      <option>Others</option>
    </select>
    <input type="number" id="updatePrice" placeholder="Price" required>
    <input type="number" id="updateQuantity" placeholder="Quantity" required>
    <input type="date" id="updateExpiryDate">
    <select id="updateAvailability">
      <option value="true">Available</option>
      <option value="false">Not Available</option>
    </select>
    <button type="submit">Update Product</button>
  </form>
</div>

<div class="section">
  <h2>Delete Product</h2>
  <input type="number" id="deleteId" placeholder="Enter ID to Delete">
  <button onclick="deleteProduct()">Delete</button>
</div>

<div class="section">
  <h2>All Products</h2>
  <button onclick="fetchAllProducts()">Load All</button>
  <table id="allTable"></table>
</div>

<div class="section">
  <h2>Get Product By ID</h2>
  <input type="number" id="getId" placeholder="Enter ID">
  <button onclick="fetchById()">Get Product</button>
  <table id="idTable"></table>
</div>

<div class="section">
  <h2>Products by Category</h2>
  <select id="getCategory">
    <option>BeautyCare</option>
    <option>Vegetables</option>
    <option>Meat</option>
    <option>Groceries</option>
    <option>Others</option>
  </select>
  <button onclick="fetchByCategory()">Load By Category</button>
  <table id="categoryTable"></table>
</div>

<div class="section">
  <h2>Available Products</h2>
  <button onclick="fetchAvailable()">Load Available Products</button>
  <table id="availableTable"></table>
</div>

<div class="section">
  <h2>Expiring Soon (Next 7 Days)</h2>
  <button onclick="fetchExpiring()">Load Expiring Products</button>
  <table id="expiringTable"></table>
</div>

<div class="section">
  <h2>Discounted Products</h2>
  <form id="discountForm">
    <select id="discountCategory">
      <option>BeautyCare</option>
      <option>Vegetables</option>
      <option>Meat</option>
      <option>Groceries</option>
      <option>Others</option>
    </select>
    <input type="number" id="discountValue" placeholder="Discount Rate (e.g., 20)" required>
    <button type="submit">Apply Discount</button>
  </form>
  <table id="discountTable"></table>
</div>

<div class="section">
  <h2>Total Value by Category</h2>
  <button onclick="fetchTotalValue()">Load Report</button>
  <table id="totalValueTable"></table>
</div>

<script>
const api = 'http://localhost:8089/api/product';

productForm.onsubmit = async function(e) {
  e.preventDefault();
  const product = {
    id: parseInt(id.value),
    name: name.value,
    productCategory: category.value,
    price: parseFloat(price.value),
    quantity: parseInt(quantity.value),
    expiryDate: expiryDate.value || null,
    availablity: availability.value === 'true'
  };
  await fetch(`${api}/add`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(product)
  });
  alert('Product added.');
  productForm.reset();
};

updateForm.onsubmit = async function(e) {
  e.preventDefault();
  const product = {
    id: parseInt(updateId.value),
    name: updateName.value,
    productCategory: updateCategory.value,
    price: parseFloat(updatePrice.value),
    quantity: parseInt(updateQuantity.value),
    expiryDate: updateExpiryDate.value || null,
    availablity: updateAvailability.value === 'true'
  };
  await fetch(`${api}/update`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(product)
  });
  alert('Product updated.');
  updateForm.reset();
};

async function deleteProduct() {
  await fetch(`${api}/${deleteId.value}`, { method: 'DELETE' });
  alert('Product deleted.');
}

async function fetchAllProducts() {
  const res = await fetch(`${api}/all`);
  const data = await res.json();
  renderTable('allTable', data);
}

async function fetchById() {
  const res = await fetch(`${api}/${getId.value}`);
  const data = await res.json();
  renderTable('idTable', [data]);
}

async function fetchByCategory() {
  const res = await fetch(`${api}/category?category=${getCategory.value}`);
  const data = await res.json();
  renderTable('categoryTable', data);
}

async function fetchAvailable() {
  const res = await fetch(`${api}/availability?available=true`);
  const data = await res.json();
  renderTable('availableTable', data);
}

async function fetchExpiring() {
  const res = await fetch(`${api}/expiring-soon`);
  const data = await res.json();
  renderTable('expiringTable', data);
}

discountForm.onsubmit = async function(e) {
  e.preventDefault();
  const category = discountCategory.value;
  const rate = parseFloat(discountValue.value);
  const res = await fetch(`${api}/discount?category=${category}&rate=${rate}`);
  const data = await res.json();
  renderDiscountTable('discountTable', data);
};

async function fetchTotalValue() {
  const res = await fetch(`${api}/total-value`);
  const data = await res.json();
  renderTotalValueTable('totalValueTable', data);
}

function renderTable(tableId, data) {
  let html = '<tr><th>ID</th><th>Name</th><th>Category</th><th>Price</th><th>Qty</th><th>Expiry</th><th>Available</th></tr>';
  data.forEach(p => {
    html += `<tr>
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.productCategory}</td>
      <td>${p.price.toFixed(2)}</td>
      <td>${p.quantity}</td>
      <td>${p.expiryDate || '—'}</td>
      <td>${p.availablity ? 'Yes' : 'No'}</td>
    </tr>`;
  });
  document.getElementById(tableId).innerHTML = html;
}

function renderDiscountTable(tableId, data) {
  let html = '<tr><th>ID</th><th>Name</th><th>Category</th><th>Discounted Price</th><th>Qty</th><th>Expiry</th><th>Available</th></tr>';
  data.forEach(p => {
    html += `<tr>
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.productCategory}</td>
      <td>${p.price.toFixed(2)}</td>
      <td>${p.quantity}</td>
      <td>${p.expiryDate || '—'}</td>
      <td>${p.availablity ? 'Yes' : 'No'}</td>
    </tr>`;
  });
  document.getElementById(tableId).innerHTML = html;
}

function renderTotalValueTable(tableId, data) {
  let html = '<tr><th>Category</th><th>Total Value</th></tr>';
  for (const [category, value] of Object.entries(data)) {
    html += `<tr><td>${category}</td><td>${value.toFixed(2)}</td></tr>`;
  }
  document.getElementById(tableId).innerHTML = html;
}
</script>

</body>
</html>